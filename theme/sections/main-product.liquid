{%- render 'product-schema', product: product -%}

<section class="oneeko-product">
  <div class="op-container">
    <div class="op-grid">
      <!-- Product Images -->
      <div class="op-media">
        {%- render 'product-gallery', product: product -%}
      </div>

      <!-- Product Info / Buy Box (right column) -->
      <aside class="op-buybox">
        <h1 class="product-page__title">{{ product.title }}</h1>

        {%- if product.vendor != blank and section.settings.show_vendor -%}
          <p class="product-page__vendor">{{ product.vendor }}</p>
        {%- endif -%}

        <!-- Price -->
        <div class="product-page__price-wrapper">
          <div class="product-page__price">
            {%- if product.compare_at_price > product.price -%}
              <span class="product-page__price-sale">{{ product.price | money }}</span>
              <span class="product-page__price-compare">{{ product.compare_at_price | money }}</span>
              <span class="product-page__price-badge">
                Save {{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
              </span>
            {%- else -%}
              <span class="product-page__price-regular">{{ product.price | money }}</span>
            {%- endif -%}
          </div>
        </div>

        <!-- Stock Indicator -->
        {%- render 'stock-indicator', product: product -%}

        <!-- Urgency Timer -->
        {%- if section.settings.show_urgency -%}
          {%- render 'urgency-timer' -%}
        {%- endif -%}

        <!-- Trust Badges -->
        {%- render 'trust-badges' -%}

        <!-- Product Form -->
        {% form 'product', product, id: 'product-form', class: 'product-form' %}
          {%- unless product.has_only_default_variant -%}
            <div class="product-form__variants">
              {%- for option in product.options_with_values -%}
                <div class="product-form__option">
                  <label for="Option-{{ forloop.index }}">{{ option.name }}</label>
                  <select
                    id="Option-{{ forloop.index }}"
                    name="options[{{ option.name }}]"
                    class="product-form__select"
                  >
                    {%- for value in option.values -%}
                      <option value="{{ value }}">{{ value }}</option>
                    {%- endfor -%}
                  </select>
                </div>
              {%- endfor -%}
            </div>
          {%- endunless -%}

          <!-- Quantity -->
          <div class="product-form__quantity">
            <label for="Quantity">{{ 'products.product.quantity' | t }}</label>
            <div class="quantity-selector">
              <button type="button" class="quantity-button quantity-minus" data-quantity-minus>
                <span>−</span>
              </button>
              <input
                type="number"
                id="Quantity"
                name="quantity"
                value="1"
                min="1"
                class="quantity-input"
                data-quantity-input
                inputmode="numeric"
                pattern="[0-9]*"
              >
              <button type="button" class="quantity-button quantity-plus" data-quantity-plus>
                <span>+</span>
              </button>
            </div>
          </div>

          <!-- Add to Cart Buttons (Amazon Style) -->
          <div class="product-form__buttons">
            <button
              type="submit"
              name="add"
              class="btn-amazon btn-amazon-cart"
              {% unless product.available %}disabled{% endunless %}
            >
              {%- if product.available -%}
                Add to Cart
              {%- else -%}
                Sold Out
              {%- endif -%}
            </button>
          </div>
        {% endform %}

        <!-- Buy Now Button -->
        {%- if product.available -%}
          <div class="product-form__buy-now">
            <button
              type="button"
              class="btn-amazon btn-amazon-buy"
              onclick="window.location.href='/cart/add?id={{ product.selected_or_first_available_variant.id }}&quantity=1&return_to=/checkout'"
            >
              Buy Now
            </button>
          </div>
        {%- endif -%}

        <!-- BEGIN: extras that will be moved under gallery -->
        <div id="op-buybox-extras">
          <!-- About this item (Amazon Style) -->
        <div class="product-page__about">
          <h2 class="product-about__title">About this item</h2>

          <ul class="product-about__features">
            {%- if product.metafields.custom.feature_1 != blank -%}
              <li>{{ product.metafields.custom.feature_1 }}</li>
            {%- else -%}
              <li><strong>High Quality:</strong> Premium materials and construction ensure long-lasting durability and reliable performance</li>
            {%- endif -%}

            {%- if product.metafields.custom.feature_2 != blank -%}
              <li>{{ product.metafields.custom.feature_2 }}</li>
            {%- else -%}
              <li><strong>Easy to Use:</strong> Simple setup and intuitive operation make this product perfect for everyone</li>
            {%- endif -%}

            {%- if product.metafields.custom.feature_3 != blank -%}
              <li>{{ product.metafields.custom.feature_3 }}</li>
            {%- else -%}
              <li><strong>Great Value:</strong> Excellent quality at an affordable price point with fast shipping</li>
            {%- endif -%}

            {%- if product.metafields.custom.feature_4 != blank -%}
              <li>{{ product.metafields.custom.feature_4 }}</li>
            {%- else -%}
              <li><strong>Satisfaction Guaranteed:</strong> 30-day easy returns and excellent customer support</li>
            {%- endif -%}

            {%- if product.metafields.custom.feature_5 != blank -%}
              <li>{{ product.metafields.custom.feature_5 }}</li>
            {%- else -%}
              <li><strong>Fast Shipping:</strong> Free shipping on orders over $50, delivered straight to your door</li>
            {%- endif -%}
          </ul>
        </div>

        <!-- Product Specifications -->
        <div class="product-page__specifications">
          <h2 class="product-specs__title">Product Information</h2>

          <div class="product-specs__table" data-specifications-only>
            {%- if product.metafields.custom.material != blank -%}
              <div class="spec-row">
                <div class="spec-label">Material</div>
                <div class="spec-value">{{ product.metafields.custom.material }}</div>
              </div>
            {%- endif -%}

            {%- if product.metafields.custom.dimensions != blank -%}
              <div class="spec-row">
                <div class="spec-label">Dimensions</div>
                <div class="spec-value">{{ product.metafields.custom.dimensions }}</div>
              </div>
            {%- endif -%}

            {%- if product.metafields.custom.weight != blank -%}
              <div class="spec-row">
                <div class="spec-label">Weight</div>
                <div class="spec-value">{{ product.metafields.custom.weight }}</div>
              </div>
            {%- endif -%}

            <div class="spec-row">
              <div class="spec-label">Manufacturer</div>
              <div class="spec-value">{{ product.vendor | default: "OneEko" }}</div>
            </div>

            {%- if product.variants.first.sku != blank -%}
              <div class="spec-row">
                <div class="spec-label">SKU</div>
                <div class="spec-value">{{ product.variants.first.sku }}</div>
              </div>
            {%- endif -%}
          </div>
        </div>

          <!-- Panel Triggers (open wide inline expansions) -->
          <div class="op-accordion-group">
            <button class="op-panel-trigger" data-panel="details">Details</button>
            <button class="op-panel-trigger" data-panel="shipping">Shipping &amp; Returns</button>
            <button class="op-panel-trigger" data-panel="faq">FAQ</button>
            {%- if product.metafields.custom.specs_html and product.metafields.custom.specs_html != blank -%}
              <button class="op-panel-trigger" data-panel="specs">Specifications</button>
            {%- endif -%}
          </div>
        </div>
        <!-- END: extras -->
      </aside>
    </div>

    <!-- Target where the extras will be reinserted (full-width) -->
    <section id="op-extras-target" class="op-extras-wide" aria-live="polite"></section>

    <!-- Wide inline expansion host (hidden by default) -->
    <section id="op-wide" class="op-wide" aria-hidden="true">
      <div class="op-wide__inner">
        <button type="button" class="op-wide__close" data-wide-close aria-label="Close">×</button>
        <div class="op-wide__content" data-wide-content></div>
      </div>
    </section>

    <!-- Hidden content sources -->
    <div id="op-panel-src" class="op-panel-src" hidden>
      <section data-src="details" class="rte">
        <h2>Details</h2>
        <div class="op-details rte op-details--clamped" data-details>
          {{ product.description }}
        </div>
        <button type="button" class="op-readmore" data-readmore hidden>Show more</button>
      </section>

      <section data-src="shipping" class="rte">
        <h2>Shipping &amp; Returns</h2>
        <div class="shipping-info">
          <div class="shipping-info__item">
            <strong>Free Shipping</strong>
            <p>On all orders over $50. Standard delivery in 3-5 business days.</p>
          </div>
          <div class="shipping-info__item">
            <strong>30-Day Returns</strong>
            <p>Not satisfied? Return within 30 days for a full refund. No questions asked.</p>
          </div>
        </div>
      </section>

      <section data-src="faq" class="rte">
        <h2>FAQ</h2>
        <div class="faq-list">
          <div class="faq-item">
            <strong>How long does shipping take?</strong>
            <p>Standard shipping takes 3-5 business days. Express shipping (1-2 days) is available at checkout.</p>
          </div>
          <div class="faq-item">
            <strong>What's your warranty policy?</strong>
            <p>All products come with a 1-year manufacturer warranty covering defects in materials and workmanship.</p>
          </div>
          <div class="faq-item">
            <strong>Do you ship internationally?</strong>
            <p>Yes! We ship worldwide. International shipping times vary by location (7-14 business days).</p>
          </div>
        </div>
      </section>

      {%- if product.metafields.custom.specs_html and product.metafields.custom.specs_html != blank -%}
      <section data-src="specs" class="rte">
        <h2>Specifications</h2>
        {{ product.metafields.custom.specs_html | metafield_text }}
      </section>
      {%- endif -%}
    </div>
  </div>
</section>

<!-- Mobile Sticky Add to Cart Bar -->
<aside class="mobile-atc-bar" data-mobile-atc>
  <div class="mobile-atc-bar__price">
    {{ product.price | money }}
  </div>
  <button
    type="button"
    class="mobile-atc-bar__btn"
    data-mobile-atc-btn
    {% unless product.available %}disabled{% endunless %}
  >
    {%- if product.available -%}
      Add to Cart
    {%- else -%}
      Sold Out
    {%- endif -%}
  </button>
</aside>

<style>
  /* Product Page Wrapper - Constrain Width */
  .product-page {
    background-color: #ffffff;
    padding: 8px 12px;
  }

  .product-page__wrapper {
    max-width: 1400px;
    margin: 0 auto;
  }

  .product-page__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }

  @media (min-width: 768px) {
    .product-page__grid {
      grid-template-columns: 1.8fr 1fr;
      gap: 24px;
    }
  }

  /* Product Info Card - No background, no borders */
  .product-page__info {
    background-color: transparent;
    padding: 0;
  }

  /* Product Gallery Card - No background, no borders */
  .product-page__gallery {
    background-color: transparent;
    padding: 0;
  }

  .product-page__title {
    font-size: 18px;
    font-weight: 400;
    margin-bottom: 4px;
    line-height: 1.2;
    color: #0F1111;
  }

  .product-page__vendor {
    font-size: 12px;
    color: #007185;
    margin-bottom: 2px;
  }

  .product-page__price-wrapper {
    margin-bottom: 8px;
  }

  .product-page__price {
    display: flex;
    align-items: baseline;
    gap: 6px;
    flex-wrap: wrap;
  }

  .product-page__price-regular,
  .product-page__price-sale {
    font-size: 20px;
    font-weight: 400;
    color: #0F1111;
  }

  .product-page__price-sale {
    color: #B12704;
  }

  .product-page__price-compare {
    font-size: 12px;
    color: #565959;
    text-decoration: line-through;
  }

  .product-page__price-badge {
    padding: 1px 6px;
    background-color: #CC0C39;
    color: white;
    font-size: 10px;
    font-weight: 700;
    border-radius: 2px;
  }

  .product-form {
    margin-bottom: 8px;
  }

  .product-form__option {
    margin-bottom: 8px;
  }

  .product-form__option label {
    display: block;
    margin-bottom: 2px;
    font-weight: 700;
    font-size: 12px;
    color: #0F1111;
  }

  .product-form__select {
    width: 100%;
    font-size: 13px;
    padding: 4px 6px;
    border: 1px solid #D5D9D9;
    border-radius: 8px;
    background-color: #F0F2F2;
  }

  .product-form__quantity {
    margin-bottom: 8px;
  }

  .product-form__quantity label {
    display: block;
    margin-bottom: 2px;
    font-weight: 700;
    font-size: 12px;
    color: #0F1111;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    gap: 3px;
    max-width: 110px;
  }

  .quantity-button {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #F0F2F2;
    border: 1px solid #D5D9D9;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.15s;
  }

  .quantity-button:hover {
    background-color: #E3E6E6;
  }

  .quantity-input {
    flex: 1;
    text-align: center;
    font-weight: 400;
    font-size: 13px;
    padding: 4px;
    border: 1px solid #D5D9D9;
    border-radius: 8px;
    background-color: #F0F2F2;
  }

  .product-form__buttons {
    margin-bottom: 8px;
  }

  .product-form__buy-now {
    margin-bottom: 12px;
  }

  /* Amazon-Style Buttons */
  .btn-amazon {
    width: 100%;
    max-width: 300px;
    padding: 10px 16px;
    font-size: 13px;
    font-weight: 400;
    border: 1px solid;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
  }

  .btn-amazon-cart {
    background: linear-gradient(to bottom, #f7dfa5, #f0c14b);
    border-color: #a88734 #9c7e31 #846a29;
    color: #111;
  }

  .btn-amazon-cart:hover {
    background: linear-gradient(to bottom, #f5d78e, #edb932);
  }

  .btn-amazon-buy {
    background: linear-gradient(to bottom, #f3a847, #f08804);
    border-color: #e47911;
    color: #111;
  }

  .btn-amazon-buy:hover {
    background: linear-gradient(to bottom, #f2a03e, #f18904);
  }

  /* Amazon-Style About Section */
  .product-page__about {
    padding-top: 12px;
    border-top: 1px solid #D5D9D9;
    margin-bottom: 12px;
  }

  .product-about__title {
    font-size: 14px;
    font-weight: 700;
    color: #0F1111;
    margin-bottom: 6px;
  }

  .product-about__features {
    list-style: disc;
    padding-left: 18px;
    margin: 0;
  }

  .product-about__features li {
    margin-bottom: 6px;
    font-size: 13px;
    line-height: 1.4;
    color: #0F1111;
  }

  /* Product Description */
  .product-page__description {
    padding-top: 12px;
    padding-bottom: 12px;
    border-top: 1px solid #D5D9D9;
    margin-bottom: 0;
  }

  .product-page__description p {
    font-size: 13px;
    line-height: 1.4;
    color: #0F1111;
    margin-bottom: 10px;
  }

  /* Amazon-Style Specifications Table */
  .product-page__specifications {
    padding-top: 12px;
    border-top: 1px solid #D5D9D9;
    margin-bottom: 12px;
  }

  .product-specs__title {
    font-size: 14px;
    font-weight: 700;
    color: #0F1111;
    margin-bottom: 8px;
  }

  .product-specs__table {
    background-color: #ffffff;
  }

  .spec-row {
    display: grid;
    grid-template-columns: 130px 1fr;
    gap: 10px;
    padding: 6px 0;
    border-bottom: 1px solid #E7E7E7;
    font-size: 13px;
  }

  .spec-row:first-child {
    padding-top: 0;
  }

  .spec-row:last-child {
    border-bottom: none;
  }

  .spec-label {
    font-weight: 700;
    color: #0F1111;
  }

  .spec-value {
    color: #0F1111;
  }

  /* Hide images in About, Specifications, and Description sections */
  .product-page__about img,
  .product-page__specifications img,
  .product-page__description img {
    display: none !important;
  }

  /* Hide duplicate headings in description that match our sections */
  .product-page__description h2,
  .product-page__description h3 {
    display: none;
  }

  /* Hide "SPECIFICATIONS" text and similar headings from description */
  .product-page__description strong:only-child {
    display: none;
  }
</style>

<script>
  // Quantity Selector
  document.querySelectorAll('[data-quantity-minus]').forEach(button => {
    button.addEventListener('click', () => {
      const input = button.parentElement.querySelector('[data-quantity-input]');
      const currentValue = parseInt(input.value) || 1;
      if (currentValue > 1) {
        input.value = currentValue - 1;
      }
    });
  });

  document.querySelectorAll('[data-quantity-plus]').forEach(button => {
    button.addEventListener('click', () => {
      const input = button.parentElement.querySelector('[data-quantity-input]');
      const currentValue = parseInt(input.value) || 1;
      input.value = currentValue + 1;
    });
  });

  // Remove all images from description, about, and specifications
  document.addEventListener('DOMContentLoaded', () => {
    const aboutSection = document.querySelector('.product-page__about');
    if (aboutSection) {
      aboutSection.querySelectorAll('img').forEach(img => img.remove());
    }

    const specificationsSection = document.querySelector('.product-page__specifications');
    if (specificationsSection) {
      specificationsSection.querySelectorAll('img').forEach(img => img.remove());
    }

    const description = document.querySelector('.product-page__description');
    if (description) {
      description.querySelectorAll('img').forEach(img => img.remove());
    }
  });

  // Remove inline heights that force tall/narrow frames
  document.addEventListener('DOMContentLoaded', function () {
    var root = document.querySelector('.op-gallery--stacked');
    if (!root) return;
    root.querySelectorAll('[style*="height"], [style*="min-height"]').forEach(function(el){
      el.style.height = '';
      el.style.minHeight = '';
    });
  });
</script>

{% schema %}
{
  "name": "Product Information",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_urgency",
      "label": "Show Urgency Timer",
      "default": true
    }
  ]
}
{% endschema %}
