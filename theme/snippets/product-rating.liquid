{%- comment -%}
  Product rating stars snippet
  Displays star rating if product has reviews metafield
  Usage: {% render 'product-rating', product: product %}
{%- endcomment -%}

{%- liquid
  assign rating_value = product.metafields.reviews.rating.value
  assign rating_count = product.metafields.reviews.rating_count
-%}

{%- if rating_value and rating_value > 0 -%}
  <div class="product-rating">
    <div class="product-rating__stars">
      {%- liquid
        assign rating_decimal = 0
        assign rating_full = rating_value | floor
        assign rating_remainder = rating_value | modulo: 1
        assign rating_half = 0
        assign rating_half_position = 0

        if rating_remainder >= 0.25 and rating_remainder < 0.75
          assign rating_half = 1
          assign rating_half_position = rating_full | plus: 1
        elsif rating_remainder >= 0.75
          assign rating_full = rating_full | plus: 1
        endif
      -%}

      {%- for i in (1..5) -%}
        {%- if i <= rating_full -%}
          <span class="product-rating__star product-rating__star--full">★</span>
        {%- elsif rating_half == 1 and i == rating_half_position -%}
          <span class="product-rating__star product-rating__star--half">★</span>
        {%- else -%}
          <span class="product-rating__star product-rating__star--empty">★</span>
        {%- endif -%}
      {%- endfor -%}
    </div>

    {%- if rating_count -%}
      <span class="product-rating__count">({{ rating_count }})</span>
    {%- endif -%}
  </div>
{%- endif -%}

<style>
  .product-rating {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    margin-bottom: var(--spacing-2);
  }

  .product-rating__stars {
    display: flex;
    align-items: center;
    gap: 2px;
  }

  .product-rating__star {
    font-size: var(--font-size-base);
    line-height: 1;
  }

  .product-rating__star--full {
    color: var(--color-cta-orange);
  }

  .product-rating__star--half {
    background: linear-gradient(90deg, var(--color-cta-orange) 50%, var(--color-border) 50%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .product-rating__star--empty {
    color: var(--color-border);
  }

  .product-rating__count {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }
</style>
