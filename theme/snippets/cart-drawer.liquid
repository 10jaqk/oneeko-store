<div class="cart-drawer" data-cart-drawer>
  <div class="cart-drawer__overlay" data-cart-close></div>
  <div class="cart-drawer__panel">
    <div class="cart-drawer__header">
      <h2 class="cart-drawer__title">{{ 'cart.general.title' | t }} ({{ cart.item_count }})</h2>
      <button
        type="button"
        class="cart-drawer__close-btn"
        data-cart-close
        aria-label="{{ 'general.accessibility.close' | t }}"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="cart-drawer__body">
      {%- if cart.item_count > 0 -%}
        <div class="cart-drawer__items">
          {%- for item in cart.items -%}
            <div class="cart-line" data-cart-item="{{ item.key }}">
              <a href="{{ item.url }}">
                <img
                  src="{{ item.image | img_url: '120x' }}"
                  alt="{{ item.title | escape }}"
                  class="cart-line__img"
                  width="60"
                  height="60"
                  loading="lazy"
                >
              </a>

              <div class="cart-line__content">
                <a href="{{ item.url }}" class="cart-line__title">
                  {{ item.product.title }}
                </a>
                {%- if item.variant.title != 'Default Title' -%}
                  <p class="cart-line__meta">{{ item.variant.title }}</p>
                {%- endif -%}
              </div>

              <p class="cart-line__price">{{ item.final_line_price | money }}</p>

              <div class="cart-line__actions">
                <label for="quantity-drawer-{{ item.key }}" class="visually-hidden">
                  {{ 'cart.general.quantity' | t }}
                </label>
                <div class="cart-qty">
                  <button type="button" class="cart-qty__btn" data-quantity-minus aria-label="Decrease quantity">âˆ’</button>
                  <input
                    type="number"
                    id="quantity-drawer-{{ item.key }}"
                    class="cart-qty__input"
                    value="{{ item.quantity }}"
                    min="0"
                    data-cart-item-key="{{ item.key }}"
                    data-quantity-input
                  >
                  <button type="button" class="cart-qty__btn" data-quantity-plus aria-label="Increase quantity">+</button>
                </div>

                <button
                  type="button"
                  class="cart-line__remove"
                  data-cart-remove="{{ item.key }}"
                  aria-label="{{ 'cart.general.remove' | t }}"
                >
                  Remove
                </button>
              </div>
            </div>
          {%- endfor -%}
        </div>

        {%- render 'free-shipping-bar' -%}

        <div class="cart-drawer__footer">
          <div class="cart-drawer__subtotal">
            <span class="cart-drawer__subtotal-label">{{ 'cart.general.subtotal' | t }}</span>
            <span class="cart-drawer__subtotal-price">{{ cart.total_price | money }}</span>
          </div>

          <p class="cart-drawer__note">{{ 'cart.general.taxes_and_shipping' | t }}</p>

          <div class="cart-drawer__buttons">
            <a href="{{ routes.cart_url }}" class="btn btn--secondary">
              {{ 'cart.general.title' | t }}
            </a>

            <form action="{{ routes.cart_url }}" method="post" style="margin: 0;">
              <button type="submit" name="checkout" class="btn btn--primary">
                {{ 'cart.general.checkout' | t }}
              </button>
            </form>
          </div>
        </div>
      {%- else -%}
        <div class="cart-drawer__empty">
          <svg class="cart-drawer__empty-icon" width="56" height="56" viewBox="0 0 64 64" fill="none">
            <path d="M8 16h48l-4 32H12L8 16z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 24v-8a12 12 0 0124 0v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <p class="cart-drawer__empty-text">{{ 'cart.general.empty' | t }}</p>
          <a href="{{ routes.all_products_collection_url }}" class="btn btn--primary" data-cart-close>
            {{ 'cart.general.continue_shopping' | t }}
          </a>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
/* Compact Cart Drawer - Amazon Style */
:root {
  --cart-text: #111827;
  --cart-muted: #6b7280;
  --cart-divider: #e5e7eb;
  --cart-cta: #d46b08;
  --cart-cta-hover: #bb5f07;
  --cart-success: #10b981;
  --cart-bg-light: #f9fafb;
}

.cart-drawer {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  pointer-events: none;
}

.cart-drawer.active {
  opacity: 1;
  visibility: visible;
  pointer-events: all;
}

.cart-drawer__overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  cursor: pointer;
}

.cart-drawer__panel {
  position: absolute;
  top: 0;
  right: 0;
  width: min(460px, 100vw);
  max-width: 100%;
  height: 100%;
  background-color: #fff;
  box-shadow: -2px 0 12px rgba(0, 0, 0, 0.1);
  transform: translateX(100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  flex-direction: column;
}

.cart-drawer.active .cart-drawer__panel {
  transform: translateX(0);
}

.cart-drawer__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  border-bottom: 1px solid var(--cart-divider);
  flex-shrink: 0;
}

.cart-drawer__title {
  font-size: 16px;
  font-weight: 600;
  color: var(--cart-text);
  margin: 0;
}

.cart-drawer__close-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  background: none;
  border: none;
  color: var(--cart-muted);
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.15s ease;
}

.cart-drawer__close-btn:hover {
  background-color: var(--cart-bg-light);
  color: var(--cart-text);
}

.cart-drawer__body {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.cart-drawer__items {
  flex: 1;
  overflow-y: auto;
  padding: 0 16px;
}

.cart-line {
  display: grid;
  grid-template-columns: 60px 1fr auto;
  gap: 12px;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--cart-divider);
}

.cart-line__img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 6px;
  background-color: var(--cart-bg-light);
  display: block;
}

.cart-line__content {
  min-width: 0;
}

.cart-line__title {
  font-size: 14px;
  line-height: 1.3;
  color: var(--cart-text);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-decoration: none;
  margin: 0 0 2px 0;
  font-weight: 600;
}

.cart-line__title:hover {
  color: #2563eb;
}

.cart-line__meta {
  font-size: 12px;
  color: var(--cart-muted);
  margin: 2px 0 0 0;
}

.cart-line__price {
  text-align: right;
  font-weight: 700;
  font-size: 16px;
  color: var(--cart-text);
  margin: 0;
}

.cart-line__actions {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 4px;
}

.cart-qty {
  display: flex;
  align-items: center;
  gap: 0;
  border: 1px solid var(--cart-divider);
  border-radius: 8px;
  overflow: hidden;
}

.cart-qty__btn {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #fff;
  border: none;
  color: var(--cart-muted);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
}

.cart-qty__btn:hover {
  background-color: var(--cart-bg-light);
  color: var(--cart-text);
}

.cart-qty__input {
  width: 54px;
  height: 36px;
  text-align: center;
  border: none;
  border-left: 1px solid var(--cart-divider);
  border-right: 1px solid var(--cart-divider);
  font-size: 14px;
  font-weight: 600;
  color: var(--cart-text);
  padding: 0;
}

.cart-qty__input::-webkit-inner-spin-button,
.cart-qty__input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.cart-qty__input:focus {
  outline: none;
}

.cart-line__remove {
  font-size: 12px;
  color: var(--cart-muted);
  background: none;
  border: none;
  text-decoration: none;
  cursor: pointer;
  padding: 0;
  transition: color 0.15s ease;
}

.cart-line__remove:hover {
  color: #dc2626;
  text-decoration: underline;
}

.free-shipping-bar {
  flex-shrink: 0;
  margin: 12px 16px 8px 16px;
  padding: 10px 12px;
  background: #ecfdf5;
  border: 1px solid #a7f3d0;
  border-radius: 8px;
}

.free-shipping-bar__message {
  font-size: 13px;
  color: #047857;
  font-weight: 500;
  text-align: center;
  margin: 0 0 6px 0;
}

.free-shipping-bar__progress {
  height: 8px;
  border-radius: 999px;
  background: #d1fae5;
  overflow: hidden;
}

.free-shipping-bar__bar {
  height: 100%;
  background: var(--cart-success);
  transition: width 0.3s ease;
}

.cart-drawer__footer {
  padding: 14px 16px;
  border-top: 1px solid var(--cart-divider);
  flex-shrink: 0;
  background-color: #fff;
}

.cart-drawer__subtotal {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.cart-drawer__subtotal-label {
  font-size: 14px;
  font-weight: 500;
  color: var(--cart-text);
}

.cart-drawer__subtotal-price {
  font-size: 18px;
  font-weight: 700;
  color: var(--cart-text);
}

.cart-drawer__note {
  font-size: 12px;
  color: var(--cart-muted);
  margin: 0 0 12px 0;
  text-align: center;
}

.cart-drawer__buttons {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.cart-drawer__buttons .btn {
  height: 42px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.2s ease;
  border: none;
  font-family: inherit;
}

.btn--secondary {
  background-color: #fff;
  color: var(--cart-cta);
  border: 1px solid var(--cart-cta);
}

.btn--secondary:hover {
  background-color: #fef3e6;
  border-color: var(--cart-cta-hover);
  color: var(--cart-cta-hover);
}

.btn--primary {
  background: var(--cart-cta);
  color: #fff;
}

.btn--primary:hover {
  background: var(--cart-cta-hover);
}

.cart-drawer__empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 40px 20px;
  height: 100%;
}

.cart-drawer__empty-icon {
  color: #d1d5db;
  margin-bottom: 16px;
}

.cart-drawer__empty-text {
  font-size: 14px;
  color: var(--cart-muted);
  margin: 0 0 16px 0;
}

.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

@media (max-width: 767px) {
  .cart-drawer__panel {
    width: 100%;
    max-width: 400px;
  }
}

@media (max-width: 479px) {
  .cart-line {
    grid-template-columns: 60px 1fr;
  }

  .cart-line__price {
    grid-column: 2;
    text-align: left;
    margin-top: 2px;
  }
}
</style>
