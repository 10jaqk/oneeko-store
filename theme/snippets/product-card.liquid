{%- assign av = product.selected_or_first_available_variant -%}
<div class="pcard" data-handle="{{ product.handle }}">
  
  {%- comment -%} Media wrapper for overlay positioning {%- endcomment -%}
  <div class="pcard__media-wrapper">
    <a class="pcard__media" href="{{ product.url }}" aria-label="{{ product.title }}">
      {{ product.featured_image | image_url: width: 680 | image_tag: loading: 'lazy', class: 'pcard__img', alt: product.title }}
    </a>
    
    {%- comment -%} Actions overlay on desktop, static on mobile {%- endcomment -%}
    <div class="pcard__actions" aria-hidden="false">
      {%- if av and av.available -%}
        <form class="pcard__form" method="post" action="/cart/add">
          <input type="hidden" name="id" value="{{ av.id }}">
          <input type="hidden" name="quantity" value="1">
          <button type="submit" class="pcard__btn pcard__btn--add" data-quick-add data-variant="{{ av.id }}">
            Add to Cart
          </button>
          <button type="button" class="pcard__btn pcard__btn--buy" data-quick-buy data-variant="{{ av.id }}">
            Buy Now
          </button>
        </form>
      {%- else -%}
        <a class="pcard__btn pcard__btn--choose" href="{{ product.url }}">View Product</a>
      {%- endif -%}
    </div>
  </div>

  <div class="pcard__info">
    <h3 class="pcard__title"><a href="{{ product.url }}">{{ product.title }}</a></h3>
  </div>
  <div class="pcard__price">
    {%- render 'price', product: product -%}
  </div>
</div>
