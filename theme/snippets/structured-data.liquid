{%- comment -%}
  Schema.org structured data for better SEO
  Enhanced with breadcrumbs, collections, and comprehensive product data
{%- endcomment -%}

{%- if template.name == 'product' -%}
  {%- comment -%} Product Schema {%- endcomment -%}
  {%- assign product_image = product.featured_image | img_url: '1024x1024' | prepend: 'https:' -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": {{ product.title | json }},
    "image": [
      {%- for image in product.images limit: 5 -%}
        {{ image | img_url: 'grande' | prepend: 'https:' | json }}{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    ],
    "description": {{ product.description | strip_html | truncate: 5000 | json }},
    "brand": {
      "@type": "Brand",
      "name": {{ product.vendor | default: shop.name | json }}
    },
    "sku": {{ product.selected_or_first_available_variant.sku | default: product.id | json }},
    "offers": {
      "@type": "Offer",
      "url": {{ product.url | within: collection | default: product.url | prepend: shop.url | json }},
      "priceCurrency": {{ cart.currency.iso_code | json }},
      "price": {{ product.selected_or_first_available_variant.price | divided_by: 100.0 | json }},
      "availability": "{% if product.selected_or_first_available_variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
      "priceValidUntil": "{{ 'now' | date: '%s' | plus: 31536000 | date: '%Y-%m-%d' }}",
      "seller": {
        "@type": "Organization",
        "name": {{ shop.name | json }}
      }
      {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
      ,
      "priceSpecification": {
        "@type": "PriceSpecification",
        "price": {{ product.selected_or_first_available_variant.compare_at_price | divided_by: 100.0 | json }},
        "priceCurrency": {{ cart.currency.iso_code | json }}
      }
      {%- endif -%}
    }
    {%- if product.metafields.reviews.rating.value -%}
    ,
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": {{ product.metafields.reviews.rating.value | json }},
      "reviewCount": {{ product.metafields.reviews.count.value | default: 1 | json }}
    }
    {%- endif -%}
  }
  </script>

  {%- comment -%} Breadcrumb Schema for Product {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ shop.url | json }}
      }
      {%- if collection -%}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ collection.title | json }},
        "item": {{ collection.url | prepend: shop.url | json }}
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": {{ product.title | json }},
        "item": {{ product.url | prepend: shop.url | json }}
      }
      {%- else -%}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ product.title | json }},
        "item": {{ product.url | prepend: shop.url | json }}
      }
      {%- endif -%}
    ]
  }
  </script>

{%- elsif template.name == 'collection' -%}
  {%- comment -%} Collection Page Schema {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": {{ collection.title | json }},
    "description": {{ collection.description | strip_html | truncate: 300 | json }},
    "url": {{ collection.url | prepend: shop.url | json }}
    {%- if collection.image -%}
    ,
    "image": {
      "@type": "ImageObject",
      "url": {{ collection.image | img_url: 'grande' | prepend: 'https:' | json }}
    }
    {%- endif -%}
  }
  </script>

  {%- comment -%} Breadcrumb for Collection {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ shop.url | json }}
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": {{ collection.title | json }},
        "item": {{ collection.url | prepend: shop.url | json }}
      }
    ]
  }
  </script>

{%- elsif template.name == 'index' -%}
  {%- comment -%} Organization Schema for Homepage {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    "url": {{ shop.url | json }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ shop.brand.logo | img_url: '200x200' | prepend: 'https:' | default: 'logo.png' | asset_url | json }}
    },
    "sameAs": [
      {% if settings.social_facebook_link != blank %}"{{ settings.social_facebook_link }}"{% endif %}{% if settings.social_instagram_link != blank %},
      "{{ settings.social_instagram_link }}"{% endif %}{% if settings.social_twitter_link != blank %},
      "{{ settings.social_twitter_link }}"{% endif %}
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "email": "support@oneeko.com",
      "contactType": "Customer Service",
      "areaServed": "US",
      "availableLanguage": "English"
    }
  }
  </script>

{%- elsif template.name == 'article' -%}
  {%- comment -%} BlogPosting Schema {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": {{ article.title | json }},
    "description": {{ article.excerpt_or_content | strip_html | truncate: 300 | json }},
    {%- if article.image -%}
    "image": {
      "@type": "ImageObject",
      "url": {{ article.image | img_url: 'grande' | prepend: 'https:' | json }}
    },
    {%- endif -%}
    "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
    "dateModified": {{ article.updated_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
    "author": {
      "@type": "Person",
      "name": {{ article.author | json }}
    },
    "publisher": {
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "logo": {
        "@type": "ImageObject",
        "url": {{ shop.brand.logo | img_url: '200x200' | prepend: 'https:' | json }}
      }
    }
  }
  </script>
{%- endif -%}

{%- comment -%} Organization Schema {%- endcomment -%}
{%- assign search_url = shop.url | append: '/search?q={search_term_string}' -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": {{ search_url | json }},
    "query-input": "required name=search_term_string"
  }
}
</script>
